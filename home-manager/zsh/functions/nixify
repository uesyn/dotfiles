if [ ! -e .shell.nix ]; then
  cat <<'EOF' > .shell.nix
{
  pkgs ? import <nixpkgs> {
    overlays = [
      (import "${fetchTarball "https://github.com/nix-community/fenix/archive/main.tar.gz"}/overlay.nix")
    ];
    config = {
      allowUnfree = true;
    };
  }
}:

pkgs.mkShell {
  packages = [
    pkgs.openssl
    pkgs.pkg-config
    (fenix.fromToolchainFile { dir ./. })
  ];
}
EOF
fi

if [ ! -e ./.envrc ]; then
  echo "use nix .shell.nix" > .envrc
  direnv allow
fi

